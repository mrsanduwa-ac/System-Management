<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Out Fashion - Order Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes animateGradient{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}body{font-family:'Inter',sans-serif;background:linear-gradient(-45deg,#0f0c29,#302b63,#24243e,#0f0c29);background-size:600% 600%;animation:animateGradient 25s ease infinite;color:#e2e8f0}#passcode-modal{background-color:rgba(0,0,0,.7);backdrop-filter:blur(10px);z-index:999}#main-app{display:none}.overflow-y-auto::-webkit-scrollbar{width:8px}.overflow-y-auto::-webkit-scrollbar-track{background:#2d3748}.overflow-y-auto::-webkit-scrollbar-thumb{background:#4a5568;border-radius:10px}.card{background-color:rgba(26,32,44,.7);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.1);transition:transform .3s ease,box-shadow .3s ease}.card:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(0,0,0,.2)}.status-message{transition:all .5s ease-in-out;overflow:hidden;max-height:0;padding:0;margin-top:0;opacity:0}.status-message.show{max-height:100px;padding:.5rem;margin-top:.75rem;opacity:1}.auto-save-status{opacity:0;transition:opacity .5s ease;color:#48bb78}.auto-save-status.show{opacity:1}.text-primary{color:#e2e8f0}.text-secondary{color:#a0aec0}.bg-card-section{background-color:rgba(45,55,72,.5)}.border-theme{border-color:rgba(255,255,255,.1)}.btn-primary{background-color:#4299e1;color:#fff}.btn-primary:hover{background-color:#2b6cb0}.btn-secondary{background-color:#4a5568;color:#e2e8f0;border:1px solid #718096}.btn-secondary:hover{background-color:#2d3748}.btn-danger{background-color:#e53e3e;color:#fff}.btn-danger:hover{background-color:#c53030}.btn-info{background-color:#5a67d8;color:#fff}.btn-info:hover{background-color:#4c51bf}.btn-success{background-color:#38a169;color:#fff}.btn-success:hover{background-color:#2f855a}input,select,textarea{background-color:#1a202c;border-color:#4a5568;color:#e2e8f0}input::placeholder,textarea::placeholder{color:#718096}input[type=date]::-webkit-calendar-picker-indicator{filter:invert(.8);cursor:pointer}@media print{body>*:not(#print-area){display:none!important}#print-area{display:block!important;position:absolute;left:0;top:0;width:100%;padding:8mm;box-sizing:border-box;font-family:'Times New Roman',Times,serif;color:#000;background-color:#fff}.no-print{display:none!important}.print-header{text-align:center;margin-bottom:10px}.print-header .company-name{font-family:'Impact',Haettenschweiler,'Arial Narrow Bold',sans-serif;font-size:16pt;letter-spacing:1px}.print-header .report-title{font-size:14pt;font-weight:700;margin-top:5px;padding-bottom:5px;border-bottom:2px solid #333}.print-details-container{margin-bottom:12px;font-size:10pt;border:1px solid #ccc;padding:10px}.print-details-container p{margin:4px 0}#printCustomNote.empty{display:none}#printCustomNote{margin-top:8px!important;padding-top:8px;border-top:1px dashed #ccc;font-style:italic}.barcode-list-header{font-size:12pt;font-weight:700;margin-bottom:6px}#printBarcodeList{column-count:4;column-gap:20px;list-style:none;padding:0;margin:0;font-size:9pt;column-fill:auto}#printBarcodeList>div{break-inside:avoid-column;margin-bottom:4px;padding:2px 0;white-space:nowrap}.print-footer{position:fixed;bottom:5mm;left:8mm;right:8mm;text-align:center;font-size:8pt;color:#666;border-top:1px solid #ccc;padding-top:5px}}
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 lg:p-8">
    <div id="passcode-modal" class="fixed inset-0 flex items-center justify-center"><div class="card p-8 rounded-2xl shadow-2xl w-full max-w-sm text-center"><h2 class="text-2xl font-bold mb-4 text-primary">Enter Passcode</h2><p class="text-secondary mb-6">Please enter the passcode to access the application.</p><input type="password" id="passcodeInput" inputmode="numeric" pattern="[0-9]*" class="w-full p-3 mb-4 text-center text-lg border-2 border-blue-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" autocomplete="off" /><button id="passcodeSubmitBtn" class="w-full px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-primary">Enter</button><p id="passcode-error" class="text-red-400 mt-4 h-4"></p></div></div><div id="main-app" class="card p-6 lg:p-8 rounded-2xl shadow-2xl w-full max-w-7xl no-print"><div class="flex justify-between items-center mb-6 flex-wrap gap-4"><h1 class="text-2xl lg:text-3xl font-extrabold"><span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-300 to-purple-400">Order Management System</span></h1><div id="live-clock" class="text-xl lg:text-2xl font-bold text-slate-300 order-3 lg:order-2 w-full lg:w-auto text-center"></div></div><div class="flex flex-col lg:flex-row gap-8 mt-4"><div class="w-full lg:w-3/5 flex flex-col gap-y-6"><p class="text-center text-secondary -mt-2">Scan order items.</p><div class="p-4 bg-blue-900/30 rounded-lg border border-blue-700/50 text-center shadow-md"><p class="text-xl font-semibold text-blue-200">Unique Barcodes: <span id="uniqueOrderCount" class="text-purple-400 text-2xl font-bold">0</span></p></div><div><div class="flex flex-col sm:flex-row gap-4"><input type="text" id="orderScanInput" placeholder="Barcode number..." class="flex-grow p-3 border-2 border-blue-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 transition duration-200 shadow-sm" /><button id="addOrderBarcodeBtn" class="px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-primary">Scan</button></div><div id="statusMessage" class="status-message rounded-lg text-center font-semibold p-2"></div></div><div><h2 class="text-2xl font-bold text-primary mb-4 border-b border-theme pb-2">Scanned Barcodes</h2><div id="orderListContainer" class="bg-card-section p-4 rounded-lg border border-theme max-h-60 lg:max-h-96 overflow-y-auto shadow-inner"><ul id="scannedOrderBarcodesList" class="space-y-2"><p id="noOrderBarcodesMessage" class="text-secondary text-center py-4">No barcodes scanned.</p></ul></div></div><button id="clearCurrentOrderBtn" class="w-full px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-secondary">Clear Current Order</button></div><div class="w-full lg:w-2/5 flex flex-col gap-y-8"><div class="p-6 bg-card-section rounded-xl border border-theme shadow-inner h-fit"><h2 class="text-2xl font-bold text-primary mb-4 border-b border-theme pb-2">Export & Customize</h2><div class="mb-4"><label for="customPrintTitle" class="block mb-2 text-sm font-medium text-secondary">Custom Title for Print</label><input type="text" id="customPrintTitle" placeholder="e.g., Customer Order #123" class="w-full p-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"></div><div class="mb-4"><label for="customPrintNote" class="block mb-2 text-sm font-medium text-secondary">Custom Note for Print</label><textarea id="customPrintNote" placeholder="Add a note..." rows="2" class="w-full p-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"></textarea></div><button id="printScannedOrderBtn" class="w-full px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-info">Print Order (A4)</button><button id="downloadCsvBtn" class="mt-4 w-full px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-success">Download CSV</button></div><div class="p-6 bg-card-section rounded-xl border border-theme shadow-inner h-fit"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-primary border-b border-theme pb-2">Load Previous Orders</h2><span id="autoSaveStatus" class="auto-save-status font-semibold">âœ“ Saved</span></div><div class="mb-4"><label for="searchByDate" class="block mb-2 text-sm font-medium text-secondary">Search by Date</label><div class="flex gap-2"><input type="date" id="searchByDate" class="w-full p-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"><button id="resetDateFilterBtn" class="px-4 py-2 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-secondary text-xs">Reset</button></div></div><div class="flex flex-col sm:flex-row gap-4"><select id="savedSessionsSelect" class="flex-grow p-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"><option value="">Select a saved session</option></select><button id="loadSelectedSessionBtn" class="px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-primary">Load</button></div><button id="deleteSelectedSessionBtn" class="mt-4 w-full px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-danger">Delete</button></div></div></div></div>
    <div id="print-area" class="hidden"><div class="print-header"><p class="company-name">World Out Fashion</p><h1 class="report-title" id="printReportTitle"></h1></div><div class="print-details-container"><p><strong>Session:</strong> <span id="printSessionName"></span></p><p><strong>Date:</strong> <span id="printDate"></span></p><p id="printCustomNote" class="empty"><strong>Note:</strong> <span></span></p></div><p class="barcode-list-header">Scanned Barcodes:</p><div id="printBarcodeList"></div><div class="print-footer">Generated by Order Management System</div></div>
    
    <script>
    const WEB_APP_URL="https://script.google.com/macros/s/AKfycbwCvptMvfnyyT1KXET2QfFBudL95ib7kK1A737v5wYPPh_X3v4p1zUZ8VDynaZ8rLix/exec";let scannedUniqueBarcodes=new Set,currentSessionId=null,userPasscode=null,allSessions=[];const el={mainApp:document.getElementById("main-app"),passcodeModal:document.getElementById("passcode-modal"),passcodeInput:document.getElementById("passcodeInput"),passcodeSubmitBtn:document.getElementById("passcodeSubmitBtn"),passcodeError:document.getElementById("passcode-error"),statusMessage:document.getElementById("statusMessage"),customPrintTitle:document.getElementById("customPrintTitle"),customPrintNote:document.getElementById("customPrintNote"),liveClock:document.getElementById("live-clock"),uniqueOrderCount:document.getElementById("uniqueOrderCount"),orderScanInput:document.getElementById("orderScanInput"),addOrderBarcodeBtn:document.getElementById("addOrderBarcodeBtn"),scannedOrderBarcodesList:document.getElementById("scannedOrderBarcodesList"),noOrderBarcodesMessage:document.getElementById("noOrderBarcodesMessage"),orderListContainer:document.getElementById("orderListContainer"),clearCurrentOrderBtn:document.getElementById("clearCurrentOrderBtn"),printScannedOrderBtn:document.getElementById("printScannedOrderBtn"),downloadCsvBtn:document.getElementById("downloadCsvBtn"),savedSessionsSelect:document.getElementById("savedSessionsSelect"),loadSelectedSessionBtn:document.getElementById("loadSelectedSessionBtn"),deleteSelectedSessionBtn:document.getElementById("deleteSelectedSessionBtn"),searchByDate:document.getElementById("searchByDate"),resetDateFilterBtn:document.getElementById("resetDateFilterBtn"),autoSaveStatus:document.getElementById("autoSaveStatus"),printReportTitle:document.getElementById("printReportTitle"),printSessionName:document.getElementById("printSessionName"),printDate:document.getElementById("printDate"),printCustomNote:document.getElementById("printCustomNote"),printBarcodeList:document.getElementById("printBarcodeList")};async function validateAndLoadApp(e){el.passcodeError.textContent="",el.passcodeSubmitBtn.disabled=!0,el.passcodeSubmitBtn.textContent="Checking...";try{const t=`${WEB_APP_URL}?passcode=${encodeURIComponent(e)}&t=${(new Date).getTime()}`,o=await fetch(t);if(!o.ok)throw new Error("Network error");const s=await o.json();if(s.error)throw new Error(s.error);userPasscode=e,allSessions=s,el.passcodeModal.style.display="none",el.mainApp.style.display="block",initializeMainApp()}catch(e){console.error("Authentication Failed:",e.message),el.passcodeError.textContent="Invalid passcode. Please try again.",el.passcodeSubmitBtn.disabled=!1,el.passcodeSubmitBtn.textContent="Enter"}}function initializeMainApp(){updateClock(),setInterval(updateClock,1e3),filterSessionsByDate(),attachEventListeners()}function attachEventListeners(){const e=()=>{const e=el.orderScanInput.value.trim();e&&(scannedUniqueBarcodes.has(e)?showStatusMessage(`Already Scanned: ${e}`,"error"):(scannedUniqueBarcodes.add(e),renderPermanentBarcodes(),autoSaveBarcode(e),showStatusMessage(`Success: ${e}`,"success")),el.orderScanInput.value="",el.orderScanInput.focus())};el.orderScanInput.addEventListener("keypress",t=>"Enter"===t.key&&e()),el.addOrderBarcodeBtn.addEventListener("click",e),el.clearCurrentOrderBtn.addEventListener("click",()=>{confirm("Are you sure you want to clear the current scan data?")&&clearCurrentOrder()}),el.printScannedOrderBtn.addEventListener("click",printScannedOrder),el.downloadCsvBtn.addEventListener("click",downloadCsv),el.loadSelectedSessionBtn.addEventListener("click",loadSelectedSession),el.deleteSelectedSessionBtn.addEventListener("click",deleteSelectedSession),el.searchByDate.addEventListener("input",filterSessionsByDate),el.resetDateFilterBtn.addEventListener("click",()=>{el.searchByDate.value="",filterSessionsByDate()})}async function autoSaveBarcode(e){currentSessionId||(currentSessionId=(new Date).getTime().toString());const t=`Session - ${getTimestamp(currentSessionId)}`;try{el.autoSaveStatus.classList.remove("show"),await fetch(WEB_APP_URL,{method:"POST",mode:"cors",body:JSON.stringify({action:"saveBarcode",passcode:userPasscode,sessionID:currentSessionId,sessionName:t,barcode:e})}),el.autoSaveStatus.classList.add("show"),setTimeout(()=>{el.autoSaveStatus.classList.remove("show")},2e3)}catch(e){console.error("Save Error:",e)}}async function deleteSelectedSession(){const e=el.savedSessionsSelect.value;if(!e)return alert("Please select a session to delete.");if(!confirm("Are you sure you want to permanently delete this session? This cannot be undone."))return;try{const t=await fetch(WEB_APP_URL,{method:"POST",mode:"cors",body:JSON.stringify({action:"deleteSession",passcode:userPasscode,sessionID:e})}),o=await t.json();if("deleted"===o.status){alert("Session deleted successfully."),currentSessionId===e&&clearCurrentOrder();const e=await fetch(`${WEB_APP_URL}?passcode=${encodeURIComponent(userPasscode)}&t=${(new Date).getTime()}`).then(e=>e.json());allSessions=e,filterSessionsByDate()}}catch(e){console.error("Delete Error:",e),alert("Error deleting session.")}}function loadSelectedSession(){const e=el.savedSessionsSelect.value;if(!e)return alert("Please select a session to load.");const t=allSessions.find(t=>t.id===e);t&&(currentSessionId=t.id,scannedUniqueBarcodes=new Set(t.data.uniqueBarcodes||[]),renderPermanentBarcodes(),alert(`Session '${t.name}' loaded.`))}function renderPermanentBarcodes(){el.scannedOrderBarcodesList.innerHTML="";const e=scannedUniqueBarcodes.size>0;if(el.noOrderBarcodesMessage.style.display=e?"none":"block",e){const t=Array.from(scannedUniqueBarcodes).reverse();t.forEach((e,o)=>{const s=document.createElement("li");s.className="flex items-center justify-between p-2 rounded-md shadow-sm border text-lg font-medium bg-gray-700/50 border-gray-600/50 text-gray-200",s.innerHTML=`<span>${e}</span><span class="text-sm text-gray-400">#${t.length-o}</span>`,el.scannedOrderBarcodesList.appendChild(s)}),el.orderListContainer.scrollTop=0}el.uniqueOrderCount.textContent=scannedUniqueBarcodes.size}function filterSessionsByDate(){const e=el.searchByDate.value,t=e?allSessions.filter(t=>(new Date(t.createdAt)).toLocaleDateString("en-CA")===e):allSessions;el.savedSessionsSelect.innerHTML='<option value="">Select a saved session</option>',t.sort((e,t)=>t.createdAt-e.createdAt).forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,el.savedSessionsSelect.appendChild(t)})}function clearCurrentOrder(){scannedUniqueBarcodes.clear(),currentSessionId=null,renderPermanentBarcodes()}function showStatusMessage(e,t){el.statusMessage.textContent=e,el.statusMessage.className=`status-message rounded-lg text-center font-semibold p-2 ${"success"===t?"bg-green-800 text-green-200":"bg-red-800 text-red-200"}`,el.statusMessage.classList.add("show"),setTimeout(()=>el.statusMessage.classList.remove("show"),2500)}function updateClock(){el.liveClock.textContent=(new Date).toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})}function getTimestamp(e){return(new Date(parseInt(e,10))).toLocaleString("en-US",{dateStyle:"short",timeStyle:"short",hour12:!1})}function printScannedOrder(){if(0===scannedUniqueBarcodes.size)return alert("No barcodes to print.");el.printReportTitle.textContent=el.customPrintTitle.value.trim()||"Scanned Order Report",el.printSessionName.textContent=el.savedSessionsSelect.options[el.savedSessionsSelect.selectedIndex]?.textContent||"Current Session",el.printDate.textContent=(new Date).toLocaleString("en-US");const e=el.customPrintNote.value.trim();el.printCustomNote.querySelector("span").textContent=e,el.printCustomNote.classList.toggle("empty",!e),el.printBarcodeList.innerHTML=Array.from(scannedUniqueBarcodes).map((e,t)=>`<div>${t+1}. ${e}</div>`).join(""),window.print()}function downloadCsv(){if(0===scannedUniqueBarcodes.size)return alert("No barcodes to download.");const e="Barcode\n"+Array.from(scannedUniqueBarcodes).join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(t),o.download=`scanned_order_${Date.now()}.csv`,o.click(),URL.revokeObjectURL(o.href)}const handlePasscodeSubmit=()=>{const e=el.passcodeInput.value.trim();e&&validateAndLoadApp(e)};el.passcodeSubmitBtn.addEventListener("click",handlePasscodeSubmit),el.passcodeInput.addEventListener("keypress",e=>"Enter"===e.key&&handlePasscodeSubmit());
    </script>
</body>
</html>