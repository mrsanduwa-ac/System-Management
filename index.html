<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Out Fashion - Order Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        /* Base styles for all devices */
        body {
            font-family: 'Inter', sans-serif;
            color: #e2e8f0;
            background: linear-gradient(-45deg, #0f0c29, #302b63, #24243e);
        }

        /* Enhanced animated background for DESKTOP ONLY */
        @media (min-width: 768px) {
            @keyframes moveInCircle { 0% { transform: rotate(0deg); } 50% { transform: rotate(180deg); } 100% { transform: rotate(360deg); } }
            @keyframes moveVertical { 0% { transform: translateY(-50%); } 50% { transform: translateY(50%); } 100% { transform: translateY(-50%); } }
            @keyframes moveHorizontal { 0% { transform: translateX(-50%); } 50% { transform: translateX(50%); } 100% { transform: translateX(-50%); } }
            
            body { overflow: hidden; }
            .background-container { display: block; position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
            .shape { position: absolute; filter: blur(150px); }
            .shape-1 { background-color: #005f73; height: 500px; width: 500px; top: -150px; left: -150px; border-radius: 50%; animation: moveInCircle 15s ease-in-out infinite alternate; }
            .shape-2 { background-color: #0a9396; height: 400px; width: 400px; top: 50vh; left: 60vw; border-radius: 50%; animation: moveVertical 22s ease-in-out infinite alternate; }
            .shape-3 { background-color: #94d2bd; height: 350px; width: 350px; top: 30vh; left: 20vw; border-radius: 50%; animation: moveHorizontal 28s ease-in-out infinite alternate; }
            .shape-4 { background-color: #ee9b00; height: 250px; width: 250px; top: 70vh; left: 10vw; border-radius: 50%; animation: moveInCircle 18s ease-in-out infinite alternate; }
            .shape-5 { background-color: #ae2012; height: 300px; width: 300px; top: -100px; left: 70vw; border-radius: 50%; animation: moveVertical 25s ease-in-out infinite alternate; }
        }

        #passcode-modal { display: flex; align-items: center; justify-content: center; position: fixed; inset: 0; background-color: rgba(0,0,0,.7); backdrop-filter: blur(8px); z-index: 999; }
        #main-app { display: none; z-index: 1; position: relative; }
        .card{background-color:rgba(10,10,20,.7);backdrop-filter:blur(16px);border:1px solid rgba(255,255,255,.1)}
        .delete-barcode-btn{background:#c53030;color:#fff;border:none;border-radius:50%;width:24px;height:24px;line-height:24px;text-align:center;cursor:pointer;font-weight:700;margin-left:1rem;transition:background .2s;font-size:16px;padding-bottom:2px}.delete-barcode-btn:hover{background:#e53e3e}
        
        .overflow-y-auto::-webkit-scrollbar{width:8px}.overflow-y-auto::-webkit-scrollbar-track{background:#2d3748}.overflow-y-auto::-webkit-scrollbar-thumb{background:#4a5568;border-radius:10px}.status-message{transition:all .5s ease-in-out;overflow:hidden;max-height:0;padding:0;margin-top:0;opacity:0}.status-message.show{max-height:100px;padding:.5rem;margin-top:.75rem;opacity:1}.auto-save-status{opacity:0;transition:opacity .5s ease;color:#48bb78}.auto-save-status.show{opacity:1}.text-primary{color:#e2e8f0}.text-secondary{color:#a0aec0}.bg-card-section{background-color:rgba(45,55,72,.5)}.border-theme{border-color:rgba(255,255,255,.1)}.btn-primary{background-color:#4299e1;color:#fff}.btn-primary:hover{background-color:#2b6cb0}.btn-secondary{background-color:#4a5568;color:#e2e8f0;border:1px solid #718096}.btn-secondary:hover{background-color:#2d3748}.btn-danger{background-color:#e53e3e;color:#fff}.btn-danger:hover{background-color:#c53030}.btn-info{background-color:#5a67d8;color:#fff}.btn-info:hover{background-color:#4c51bf}.btn-success{background-color:#38a169;color:#fff}.btn-success:hover{background-color:#2f855a}input,select,textarea{background-color:#1a202c;border-color:#4a5568;color:#e2e8f0}input::placeholder,textarea::placeholder{color:#718096}input[type=date]::-webkit-calendar-picker-indicator{filter:invert(.8);cursor:pointer}
        .swal2-popup{background-color:#1a202c!important;color:#e2e8f0!important;border:1px solid rgba(255,255,255,.1)!important;border-radius:1rem!important}.swal2-title{color:#e2e8f0!important}.swal2-html-container{color:#a0aec0!important}.swal2-confirm,.swal2-cancel{border-radius:.5rem!important}
        
        @media print{body>*{display:none!important}#print-area{display:block!important;position:absolute;left:0;top:0;width:100%;padding:1cm;box-sizing:border-box;font-family:Arial,sans-serif;color:#000;background-color:#fff}.no-print{display:none!important}#print-header{display:flex;justify-content:space-between;align-items:center;border-bottom:2px solid #000;padding-bottom:10px;margin-bottom:15px}.print-company-name{font-size:16pt;font-weight:700}.print-date-time{font-size:10pt}#print-details-container,#printCustomNote{display:none}#printBarcodeList{font-size:9pt;padding:0;margin:0;column-count:5;column-gap:15px;height:auto;column-fill:auto}#printBarcodeList>div{break-inside:avoid;page-break-inside:avoid;padding:2px 0;white-space:nowrap}.print-footer{display:none!important}}
    </style>
</head>
<body>
    <div class="background-container" style="display: none;"> <div class="shape shape-1"></div> <div class="shape shape-2"></div> <div class="shape shape-3"></div> <div class="shape shape-4"></div> <div class="shape shape-5"></div> </div>
    <div id="passcode-modal"><div class="card p-8 rounded-2xl shadow-2xl w-full max-w-sm text-center"><h2 class="text-2xl font-bold mb-4 text-primary">Enter Passcode</h2><p class="text-secondary mb-6">Please enter the passcode to access the application.</p><input type="password" id="passcodeInput" inputmode="numeric" pattern="[0-9]*" class="w-full p-3 mb-4 text-center text-lg border-2 border-blue-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" autocomplete="off"><button id="passcodeSubmitBtn" class="w-full px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-primary">Enter</button><p id="passcode-error" class="text-red-400 mt-4 h-4"></p></div></div>
    <div id="main-app" class="p-4"><div class="card p-6 lg:p-8 rounded-2xl shadow-2xl w-full max-w-7xl no-print"><div class="flex justify-between items-center mb-6 flex-wrap gap-4"><h1 class="text-2xl lg:text-3xl font-extrabold"><span class="bg-clip-text text-transparent bg-gradient-to-r from-blue-300 to-purple-400">Order Management System</span></h1><div id="live-clock" class="text-xl lg:text-2xl font-bold text-slate-300 order-3 lg:order-2 w-full lg:w-auto text-center"></div></div><div class="flex flex-col lg:flex-row gap-8 mt-4"><div class="w-full lg:w-3/5 flex flex-col gap-y-6"><p class="text-center text-secondary -mt-2">Scan order items.</p><div class="p-4 bg-blue-900/30 rounded-lg border border-blue-700/50 text-center shadow-md"><p class="text-xl font-semibold text-blue-200">Unique Barcodes: <span id="uniqueOrderCount" class="text-purple-400 text-2xl font-bold">0</span></p></div><div><div class="flex flex-col sm:flex-row gap-4"><input type="text" id="orderScanInput" placeholder="Barcode number..." class="flex-grow p-3 border-2 border-blue-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 transition duration-200 shadow-sm"><button id="addOrderBarcodeBtn" class="px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-primary">Scan</button></div><div id="statusMessage" class="status-message rounded-lg text-center font-semibold p-2"></div></div><div><h2 class="text-2xl font-bold text-primary mb-4 border-b border-theme pb-2">Scanned Barcodes</h2><div id="orderListContainer" class="bg-card-section p-4 rounded-lg border border-theme max-h-60 lg:max-h-96 overflow-y-auto shadow-inner"><ul id="scannedOrderBarcodesList" class="space-y-2"><p id="noOrderBarcodesMessage" class="text-secondary text-center py-4">No barcodes scanned.</p></ul></div></div><button id="clearCurrentOrderBtn" class="w-full px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-secondary">Clear Current Order</button></div><div class="w-full lg:w-2/5 flex flex-col gap-y-8"><div class="p-6 bg-card-section rounded-xl border border-theme shadow-inner h-fit"><h2 class="text-2xl font-bold text-primary mb-4 border-b border-theme pb-2">Export & Customize</h2><button id="printScannedOrderBtn" class="w-full px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-info">Print Order (A4)</button><button id="downloadCsvBtn" class="mt-4 w-full px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-success">Download CSV</button></div><div class="p-6 bg-card-section rounded-xl border border-theme shadow-inner h-fit"><div class="flex justify-between items-center mb-4"><h2 class="text-2xl font-bold text-primary border-b border-theme pb-2">Load Previous Orders</h2><span id="autoSaveStatus" class="auto-save-status font-semibold">âœ“ Saved</span></div><div class="mb-4"><label for="searchByDate" class="block mb-2 text-sm font-medium text-secondary">Search by Date</label><div class="flex gap-2"><input type="date" id="searchByDate" class="w-full p-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"><button id="resetDateFilterBtn" class="px-4 py-2 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-secondary text-xs">Reset</button></div></div><div class="flex flex-col sm:flex-row gap-4"><select id="savedSessionsSelect" class="flex-grow p-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"><option value="">Select a saved session</option></select><button id="loadSelectedSessionBtn" class="px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-primary">Load</button></div><button id="deleteSelectedSessionBtn" class="mt-4 w-full px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-danger">Delete</button></div></div></div></div></div>
    <div id="print-area" class="hidden"><div id="print-header"><div class="print-company-name">WORLD OUT FASHION</div><div class="print-date-time"></div></div><div id="printBarcodeList"></div></div>
    <audio id="success-sound" src="https://www.myinstants.com/media/sounds/applepay.mp3" preload="auto"></audio>
    <audio id="error-sound" src="https://github.com/sandaruwanS/sound-effects/raw/main/error.mp3" preload="auto"></audio>
    <script>
    const WEB_APP_URL="https://script.google.com/macros/s/AKfycbwCvptMvfnyyT1KXET2QfFBudL95ib7kK1A737v5wYPPh_X3v4p1zUZ8VDynaZ8rLix/exec";let scannedUniqueBarcodes=new Set,currentSessionId=null,userPasscode=null,allSessions=[];const el={mainApp:document.getElementById("main-app"),passcodeModal:document.getElementById("passcode-modal"),passcodeInput:document.getElementById("passcodeInput"),passcodeSubmitBtn:document.getElementById("passcodeSubmitBtn"),passcodeError:document.getElementById("passcode-error"),backgroundContainer:document.querySelector(".background-container"),statusMessage:document.getElementById("statusMessage"),liveClock:document.getElementById("live-clock"),uniqueOrderCount:document.getElementById("uniqueOrderCount"),orderScanInput:document.getElementById("orderScanInput"),addOrderBarcodeBtn:document.getElementById("addOrderBarcodeBtn"),scannedOrderBarcodesList:document.getElementById("scannedOrderBarcodesList"),noOrderBarcodesMessage:document.getElementById("noOrderBarcodesMessage"),orderListContainer:document.getElementById("orderListContainer"),clearCurrentOrderBtn:document.getElementById("clearCurrentOrderBtn"),printScannedOrderBtn:document.getElementById("printScannedOrderBtn"),downloadCsvBtn:document.getElementById("downloadCsvBtn"),savedSessionsSelect:document.getElementById("savedSessionsSelect"),loadSelectedSessionBtn:document.getElementById("loadSelectedSessionBtn"),deleteSelectedSessionBtn:document.getElementById("deleteSelectedSessionBtn"),searchByDate:document.getElementById("searchByDate"),resetDateFilterBtn:document.getElementById("resetDateFilterBtn"),autoSaveStatus:document.getElementById("autoSaveStatus"),successSound:document.getElementById("success-sound"),errorSound:document.getElementById("error-sound"),printDateTime:document.querySelector(".print-date-time"),printBarcodeList:document.getElementById("printBarcodeList")};async function validateAndLoadApp(e){el.passcodeError.textContent="",el.passcodeSubmitBtn.disabled=!0,el.passcodeSubmitBtn.textContent="Checking...";try{const t=`${WEB_APP_URL}?passcode=${encodeURIComponent(e)}&t=${(new Date).getTime()}`,o=await fetch(t);if(!o.ok)throw new Error("Network error");const s=await o.json();if(s.error)throw new Error(s.error);userPasscode=e,allSessions=s,el.passcodeModal.style.display="none",document.body.style.overflow="auto",el.mainApp.style.display="block",initializeMainApp()}catch(e){el.passcodeError.textContent="Invalid passcode. Please try again.",el.passcodeSubmitBtn.disabled=!1,el.passcodeSubmitBtn.textContent="Enter"}}function initializeMainApp(){updateClock(),setInterval(updateClock,1e3),populateSessionsDropdown(allSessions),attachEventListeners()}function attachEventListeners(){el.orderScanInput.addEventListener("keypress",e=>"Enter"===e.key&&handleOrderScan()),el.addOrderBarcodeBtn.addEventListener("click",handleOrderScan),el.clearCurrentOrderBtn.addEventListener("click",clearCurrentOrder),el.printScannedOrderBtn.addEventListener("click",printScannedOrder),el.downloadCsvBtn.addEventListener("click",downloadCsv),el.loadSelectedSessionBtn.addEventListener("click",loadSelectedSession),el.deleteSelectedSessionBtn.addEventListener("click",deleteSelectedSession),el.searchByDate.addEventListener("input",filterSessionsByDate),el.resetDateFilterBtn.addEventListener("click",()=>{el.searchByDate.value="",filterSessionsByDate()}),el.scannedOrderBarcodesList.addEventListener("click",e=>{e.target.classList.contains("delete-barcode-btn")&&deleteSingleBarcode(e.target.dataset.barcode)})}async function handleOrderScan(){const e=el.orderScanInput.value.trim();if(!e)return;if(scannedUniqueBarcodes.has(e))el.errorSound.play(),showStatusMessage(`Already Scanned: ${e}`,"error");else{0===scannedUniqueBarcodes.size&&(currentSessionId=(new Date).getTime().toString()),scannedUniqueBarcodes.add(e),el.successSound.play(),renderPermanentBarcodes();const t=currentSessionId,o=`Session - ${getTimestamp(t)}`;await fetch(WEB_APP_URL,{method:"POST",mode:"cors",body:JSON.stringify({action:"saveBarcode",passcode:userPasscode,sessionID:t,sessionName:o,barcode:e})}),showStatusMessage(`Success: ${e}`,"success")}el.orderScanInput.value="",el.orderScanInput.focus()}async function deleteSingleBarcode(e){if(scannedUniqueBarcodes.has(e)){scannedUniqueBarcodes.delete(e),renderPermanentBarcodes();try{await fetch(WEB_APP_URL,{method:"POST",mode:"cors",body:JSON.stringify({action:"deleteSingleBarcode",passcode:userPasscode,sessionID:currentSessionId,barcode:e})})}catch(e){console.error("Delete Single Barcode Error:",e)}0===scannedUniqueBarcodes.size&&(currentSessionId=null)}}async function deleteSelectedSession(){const e=el.savedSessionsSelect.value;if(!e)return Swal.fire({title:"Oops...",text:"Please select a session to delete.",icon:"warning"});const t=await Swal.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Yes, delete it!"});t.isConfirmed&&fetch(WEB_APP_URL,{method:"POST",mode:"cors",body:JSON.stringify({action:"deleteSession",passcode:userPasscode,sessionID:e})}).then(t=>{Swal.fire({title:"Deleted!",text:"The session has been deleted.",icon:"success",timer:1500}),currentSessionId===e&&clearCurrentOrder(!1),allSessions=allSessions.filter(t=>t.id!==e),filterSessionsByDate()}).catch(e=>{Swal.fire("Error!","Could not delete the session.","error")})}function loadSelectedSession(){const e=el.savedSessionsSelect.value;if(!e)return Swal.fire({title:"Oops...",text:"Please select a session to load.",icon:"warning"});const t=allSessions.find(t=>t.id===e);t&&(currentSessionId=t.id,scannedUniqueBarcodes=new Set(t.data.uniqueBarcodes||[]),renderPermanentBarcodes(),Swal.fire({title:"Loaded!",text:`Session '${t.name}' has been loaded.`,icon:"success",timer:1500}))}function renderPermanentBarcodes(){el.scannedOrderBarcodesList.innerHTML="";const e=scannedUniqueBarcodes.size>0;if(el.noOrderBarcodesMessage.style.display=e?"none":"block",e){const t=Array.from(scannedUniqueBarcodes).reverse();t.forEach((e,o)=>{const s=document.createElement("li");s.className="flex items-center justify-between p-2 rounded-md shadow-sm border text-lg font-medium bg-gray-700/50 border-gray-600/50 text-gray-200",s.innerHTML=`<span>${e}</span><button class="delete-barcode-btn no-print" data-barcode="${e}" title="Delete this barcode">Ã—</button>`,el.scannedOrderBarcodesList.appendChild(s)}),el.orderListContainer.scrollTop=0}el.uniqueOrderCount.textContent=scannedUniqueBarcodes.size}function populateSessionsDropdown(e){el.savedSessionsSelect.innerHTML='<option value="">Select a saved session</option>',e.sort((e,t)=>t.createdAt-e.createdAt).forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,el.savedSessionsSelect.appendChild(t)}),el.savedSessionsSelect.value=currentSessionId}function filterSessionsByDate(){const e=el.searchByDate.value,t=e?allSessions.filter(t=>(new Date(t.createdAt)).toLocaleDateString("en-CA")===e):allSessions;populateSessionsDropdown(t)}async function clearCurrentOrder(){if(0===scannedUniqueBarcodes.size)return;const e=await Swal.fire({title:"Are you sure?",text:"This will clear all currently scanned items.",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, clear it!"});e.isConfirmed&&(scannedUniqueBarcodes.clear(),currentSessionId=null,renderPermanentBarcodes(),Swal.fire({title:"Cleared!",icon:"info",timer:1500}))}function showStatusMessage(e,t){el.statusMessage.textContent=e,el.statusMessage.className=`status-message rounded-lg text-center font-semibold p-2 ${"success"===t?"bg-green-800 text-green-200":"bg-red-800 text-red-200"}`,el.statusMessage.classList.add("show"),setTimeout(()=>el.statusMessage.classList.remove("show"),2500)}function updateClock(){el.liveClock.textContent=(new Date).toLocaleString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})}function getTimestamp(e){return(new Date(parseInt(e,10))).toLocaleString("en-US",{dateStyle:"short",timeStyle:"short",hour12:!1})}function printScannedOrder(){if(0===scannedUniqueBarcodes.size)return Swal.fire({title:"Empty!",text:"There are no barcodes to print.",icon:"warning"});el.printDateTime.textContent=(new Date).toLocaleString("en-US",{dateStyle:"long",timeStyle:"short"}),el.printBarcodeList.innerHTML=Array.from(scannedUniqueBarcodes).map((e,t)=>`<div>${t+1}. ${e}</div>`).join(""),window.print()}function downloadCsv(){if(0===scannedUniqueBarcodes.size)return Swal.fire({title:"Empty!",text:"There are no barcodes to download.",icon:"warning"});const e="Barcode\n"+Array.from(scannedUniqueBarcodes).join("\n"),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(t),o.download=`scanned_order_${Date.now()}.csv`,o.click(),URL.revokeObjectURL(o.href)}const handlePasscodeSubmit=()=>{const e=el.passcodeInput.value.trim();e&&validateAndLoadApp(e)};el.passcodeSubmitBtn.addEventListener("click",handlePasscodeSubmit),el.passcodeInput.addEventListener("keypress",e=>"Enter"===e.key&&handlePasscodeSubmit());
    </script>
</body>
</html>
