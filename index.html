<!DOCTYPE html>
<html lang="si">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Out Fashion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes animateGradient{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}body{font-family:'Inter',sans-serif;background:linear-gradient(-45deg,#0f0c29,#302b63,#24243e,#0f0c29);background-size:600% 600%;animation:animateGradient 25s ease infinite;color:#e2e8f0}#passcode-modal{background-color:rgba(0,0,0,.7);backdrop-filter:blur(10px);z-index:999}#main-app{display:none}.overflow-y-auto::-webkit-scrollbar{width:8px}.overflow-y-auto::-webkit-scrollbar-track{background:#2d3748}.overflow-y-auto::-webkit-scrollbar-thumb{background:#4a5568;border-radius:10px}.card{background-color:rgba(26,32,44,.7);backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.1);transition:transform .3s ease,box-shadow .3s ease}.card:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(0,0,0,.2)}.status-message{transition:all .5s ease-in-out;overflow:hidden;max-height:0;padding:0;margin-top:0;opacity:0}.status-message.show{max-height:100px;padding:.5rem;margin-top:.75rem;opacity:1}.auto-save-status{opacity:0;transition:opacity .5s ease;color:#48bb78}.auto-save-status.show{opacity:1}.text-primary{color:#e2e8f0}.text-secondary{color:#a0aec0}.bg-card-section{background-color:rgba(45,55,72,.5)}.border-theme{border-color:rgba(255,255,255,.1)}.btn-primary{background-color:#4299e1;color:#fff}.btn-primary:hover{background-color:#2b6cb0}.btn-secondary{background-color:#4a5568;color:#e2e8f0;border:1px solid #718096}.btn-secondary:hover{background-color:#2d3748}.btn-danger{background-color:#e53e3e;color:#fff}.btn-danger:hover{background-color:#c53030}.btn-info{background-color:#5a67d8;color:#fff}.btn-info:hover{background-color:#4c51bf}.btn-success{background-color:#38a169;color:#fff}.btn-success:hover{background-color:#2f855a}#langSinhalaBtn,#langEnglishBtn{background-color:rgba(255,255,255,.1);border-color:rgba(255,255,255,.2);color:#a0aec0}#langSinhalaBtn.active,#langEnglishBtn.active{background-color:#4299e1;color:#fff;border-color:#4299e1}.bg-green-status{background-color:#2f855a;border:1px solid #38a169;color:#c6f6d5}.bg-red-status{background-color:#c53030;border:1px solid #e53e3e;color:#fed7d7}input,select,textarea{background-color:#1a202c;border-color:#4a5568;color:#e2e8f0}input::placeholder,textarea::placeholder{color:#718096}input[type=date]::-webkit-calendar-picker-indicator{filter:invert(.8);cursor:pointer}@media print{body>*:not(#print-area){display:none!important}#print-area{display:block!important;position:absolute;left:0;top:0;width:100%;padding:8mm;box-sizing:border-box;font-family:'Times New Roman',Times,serif;color:#000;background-color:#fff}.no-print{display:none!important}.print-header{text-align:center;margin-bottom:10px}.print-header .company-name{font-family:'Impact',Haettenschweiler,'Arial Narrow Bold',sans-serif;font-size:16pt;letter-spacing:1px}.print-header .report-title{font-size:14pt;font-weight:700;margin-top:5px;padding-bottom:5px;border-bottom:2px solid #333}.print-details-container{margin-bottom:12px;font-size:10pt;border:1px solid #ccc;padding:10px}.print-details-container p{margin:4px 0}#printCustomNote.empty{display:none}#printCustomNote{margin-top:8px!important;padding-top:8px;border-top:1px dashed #ccc;font-style:italic}.barcode-list-header{font-size:12pt;font-weight:700;margin-bottom:6px}#printBarcodeList{column-count:4;column-gap:20px;list-style:none;padding:0;margin:0;font-size:9pt;column-fill:auto}#printBarcodeList>div{break-inside:avoid-column;margin-bottom:4px;padding:2px 0;white-space:nowrap}.print-footer{position:fixed;bottom:5mm;left:8mm;right:8mm;text-align:center;font-size:8pt;color:#666;border-top:1px solid #ccc;padding-top:5px}}
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 lg:p-8">
    <div id="passcode-modal" class="fixed inset-0 flex items-center justify-center"><div class="card p-8 rounded-2xl shadow-2xl w-full max-w-sm text-center"><h2 class="text-2xl font-bold mb-4 text-primary">Enter Passcode</h2><p class="text-secondary mb-6">Please enter the passcode to access the application.</p><input type="password" id="passcodeInput" inputmode="numeric" pattern="[0-9]*" class="w-full p-3 mb-4 text-center text-lg border-2 border-blue-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400" autocomplete="off" /><button id="passcodeSubmitBtn" class="w-full px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-primary">Enter</button><p id="passcode-error" class="text-red-400 mt-4 h-4"></p></div></div><div id="main-app" class="card p-6 lg:p-8 rounded-2xl shadow-2xl w-full max-w-7xl no-print"><div class="flex justify-between items-center mb-6 flex-wrap gap-4"><h1 class="text-2xl lg:text-3xl font-extrabold"><span id="appTitle" class="bg-clip-text text-transparent bg-gradient-to-r from-blue-300 to-purple-400"></span></h1><div id="live-clock" class="text-xl lg:text-2xl font-bold text-slate-300 order-3 lg:order-2 w-full lg:w-auto text-center"></div><div class="flex gap-2 order-2 lg:order-3"><button id="langSinhalaBtn" class="px-3 py-1 rounded-full text-sm font-semibold border transition-colors"></button><button id="langEnglishBtn" class="px-3 py-1 rounded-full text-sm font-semibold border transition-colors"></button></div></div><div class="flex flex-col lg:flex-row gap-8 mt-4"><div class="w-full lg:w-3/5 flex flex-col gap-y-6"><p id="scanOrderDescription" class="text-center text-secondary -mt-2"></p><div class="p-4 bg-blue-900/30 rounded-lg border border-blue-700/50 text-center shadow-md"><p class="text-xl font-semibold text-blue-200"><span id="uniqueOrderCountLabel"></span>: <span id="uniqueOrderCount" class="text-purple-400 text-2xl font-bold">0</span></p></div><div><div class="flex flex-col sm:flex-row gap-4"><input type="text" id="orderScanInput" class="flex-grow p-3 border-2 border-blue-500 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 transition duration-200 shadow-sm" /><button id="addOrderBarcodeBtn" class="px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-primary"></button></div><div id="statusMessage" class="status-message rounded-lg text-center font-semibold p-2"></div></div><div><h2 id="scannedOrderTitle" class="text-2xl font-bold text-primary mb-4 border-b border-theme pb-2"></h2><div id="orderListContainer" class="bg-card-section p-4 rounded-lg border border-theme max-h-60 lg:max-h-96 overflow-y-auto shadow-inner"><ul id="scannedOrderBarcodesList" class="space-y-2"><p id="noOrderBarcodesMessage" class="text-secondary text-center py-4"></p></ul></div></div><button id="clearCurrentOrderBtn" class="w-full px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-secondary"></button></div><div class="w-full lg:w-2/5 flex flex-col gap-y-8"><div class="p-6 bg-card-section rounded-xl border border-theme shadow-inner h-fit"><h2 id="exportTitle" class="text-2xl font-bold text-primary mb-4 border-b border-theme pb-2"></h2><div class="mb-4"><label id="customPrintTitleLabel" for="customPrintTitle" class="block mb-2 text-sm font-medium text-secondary"></label><input type="text" id="customPrintTitle" class="w-full p-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"></div><div class="mb-4"><label id="customPrintNoteLabel" for="customPrintNote" class="block mb-2 text-sm font-medium text-secondary"></label><textarea id="customPrintNote" rows="2" class="w-full p-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"></textarea></div><button id="printScannedOrderBtn" class="w-full px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-info"></button><button id="downloadCsvBtn" class="mt-4 w-full px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-success"></button></div><div class="p-6 bg-card-section rounded-xl border border-theme shadow-inner h-fit"><div class="flex justify-between items-center mb-4"><h2 id="loadPreviousOrdersTitle" class="text-2xl font-bold text-primary border-b border-theme pb-2"></h2><span id="autoSaveStatus" class="auto-save-status font-semibold">✓ Saved</span></div><div class="mb-4"><label id="searchByDateLabel" for="searchByDate" class="block mb-2 text-sm font-medium text-secondary"></label><div class="flex gap-2"><input type="date" id="searchByDate" class="w-full p-2 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"><button id="resetDateFilterBtn" class="px-4 py-2 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-secondary text-xs"></button></div></div><div class="flex flex-col sm:flex-row gap-4"><select id="savedSessionsSelect" class="flex-grow p-3 border-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-500"><option value=""></option></select><button id="loadSelectedSessionBtn" class="px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-primary"></button></div><button id="deleteSelectedSessionBtn" class="mt-4 w-full px-6 py-3 rounded-lg font-semibold shadow-md transition transform hover:scale-105 btn-danger"></button></div></div></div></div>
    <div id="print-area" class="hidden"><div class="print-header"><p class="company-name">World Out Fashion</p><h1 class="report-title" id="printReportTitle"></h1></div><div class="print-details-container"><p><strong><span id="printSessionLabel"></span></strong> <span id="printSessionName"></span></p><p><strong><span id="printDateLabel"></span></strong> <span id="printDate"></span></p><p id="printCustomNote" class="empty"><strong><span id="printNoteLabel"></span></strong> <span></span></p></div><p class="barcode-list-header" id="printExpectedItemsTitle"></p><div id="printBarcodeList"></div><div class="print-footer">Generated by Order Management System</div></div>
    
    <script>
    let currentLanguage=localStorage.getItem("appLanguage")||"si",scannedUniqueBarcodes=new Set,currentSessionId=null,userPasscode=null,allSessions=[];const el={mainApp:document.getElementById("main-app"),passcodeModal:document.getElementById("passcode-modal"),passcodeInput:document.getElementById("passcodeInput"),passcodeSubmitBtn:document.getElementById("passcodeSubmitBtn"),passcodeError:document.getElementById("passcode-error"),statusMessage:document.getElementById("statusMessage"),customPrintTitle:document.getElementById("customPrintTitle"),customPrintNote:document.getElementById("customPrintNote"),appTitle:document.getElementById("appTitle"),langSinhalaBtn:document.getElementById("langSinhalaBtn"),langEnglishBtn:document.getElementById("langEnglishBtn"),scanOrderDescription:document.getElementById("scanOrderDescription"),uniqueOrderCountLabel:document.getElementById("uniqueOrderCountLabel"),uniqueOrderCount:document.getElementById("uniqueOrderCount"),orderScanInput:document.getElementById("orderScanInput"),addOrderBarcodeBtn:document.getElementById("addOrderBarcodeBtn"),scannedOrderTitle:document.getElementById("scannedOrderTitle"),scannedOrderBarcodesList:document.getElementById("scannedOrderBarcodesList"),noOrderBarcodesMessage:document.getElementById("noOrderBarcodesMessage"),orderListContainer:document.getElementById("orderListContainer"),clearCurrentOrderBtn:document.getElementById("clearCurrentOrderBtn"),exportTitle:document.getElementById("exportTitle"),customPrintTitleLabel:document.getElementById("customPrintTitleLabel"),customPrintNoteLabel:document.getElementById("customPrintNoteLabel"),printScannedOrderBtn:document.getElementById("printScannedOrderBtn"),downloadCsvBtn:document.getElementById("downloadCsvBtn"),loadPreviousOrdersTitle:document.getElementById("loadPreviousOrdersTitle"),savedSessionsSelect:document.getElementById("savedSessionsSelect"),loadSelectedSessionBtn:document.getElementById("loadSelectedSessionBtn"),deleteSelectedSessionBtn:document.getElementById("deleteSelectedSessionBtn"),liveClock:document.getElementById("live-clock"),searchByDateLabel:document.getElementById("searchByDateLabel"),searchByDate:document.getElementById("searchByDate"),resetDateFilterBtn:document.getElementById("resetDateFilterBtn"),autoSaveStatus:document.getElementById("autoSaveStatus")},translations={si:{appTitle:"ඇණවුම් කළමනාකරණ පද්ධතිය",scanOrderDescription:"ඇණවුම් අයිතම ස්කෑන් කරන්න.",uniqueOrderCountLabel:"අද්විතීය බාර්කෝඩ්",orderScanInputPlaceholder:"බාර්කෝඩ් අංකය...",addOrderBarcodeBtn:"ස්කෑන් කරන්න",scannedOrderTitle:"ස්කෑන් කළ බාර්කෝඩ්",noOrderBarcodesMessage:"බාර්කෝඩ් ස්කෑන් කර නැත.",clearCurrentOrderBtn:"වත්මන් ඇණවුම හිස් කරන්න",exportTitle:"බාගත කිරීම සහ සැකසීම",customPrintTitleLabel:"මුද්‍රණය සඳහා නම",customPrintTitlePlaceholder:"උදා: පාරිභෝගික ඇණවුම #123",customPrintNoteLabel:"මුද්‍රණය සඳහා සටහන",customPrintNotePlaceholder:"සටහනක් එක් කරන්න...",printScannedOrderBtn:"ඇණවුම මුද්‍රණය කරන්න (A4)",downloadCsvBtn:"CSV බාගත කරන්න",loadPreviousOrdersTitle:"පෙර ඇණවුම්",searchByDateLabel:"දිනය අනුව සොයන්න",resetDateFilterBtn:"Reset",savedSessionsSelectPlaceholder:"සුරකින ලද සැසියක් තෝරන්න",loadSelectedSessionBtn:"පූරණය කරන්න",deleteSelectedSessionBtn:"මකා දමන්න",scannedSuccessfully:e=>`සාර්ථකයි: ${e}`,duplicateScan:e=>`දැනටමත් ඇත: ${e}`,alertSelectSession:"සැසියක් තෝරන්න.",alertSessionLoaded:e=>`'${e}' පූරණය විය.`,alertDeleteConfirm:"මෙම සැසිය මකා දැමීමට අවශ්‍යද?",alertSessionDeleted:"සැසිය මකා දැමිණි.",alertCurrentOrderCleared:"වත්මන් දත්ත හිස් කරන ලදී.",printReportTitle:"ස්කෑන් කළ ඇණවුම් වාර්තාව",printSessionLabel:"සැසිය:",printDateLabel:"දිනය:",printNoteLabel:"සටහන:",printExpectedItemsTitle:"ස්කෑන් කළ බාර්කෝඩ්:",sessionNamePrefix:"සැසිය",passcodeError:"වැරදි රහස් පදයක්. නැවත උත්සාහ කරන්න."},en:{appTitle:"Order Management System",scanOrderDescription:"Scan order items.",uniqueOrderCountLabel:"Unique Barcodes",orderScanInputPlaceholder:"Barcode number...",addOrderBarcodeBtn:"Scan",scannedOrderTitle:"Scanned Barcodes",noOrderBarcodesMessage:"No barcodes scanned.",clearCurrentOrderBtn:"Clear Current Order",exportTitle:"Export & Customize",customPrintTitleLabel:"Custom Title for Print",customPrintTitlePlaceholder:"e.g., Customer Order #123",customPrintNoteLabel:"Custom Note for Print",customPrintNotePlaceholder:"Add a note...",printScannedOrderBtn:"Print Order (A4)",downloadCsvBtn:"Download CSV",loadPreviousOrdersTitle:"Load Previous Orders",searchByDateLabel:"Search by Date",resetDateFilterBtn:"Reset",savedSessionsSelectPlaceholder:"Select a saved session",loadSelectedSessionBtn:"Load",deleteSelectedSessionBtn:"Delete",scannedSuccessfully:e=>`Success: ${e}`,duplicateScan:e=>`Already Scanned: ${e}`,alertSelectSession:"Please select a session.",alertSessionLoaded:e=>`'${e}' loaded.`,alertDeleteConfirm:"Are you sure you want to delete this session?",alertSessionDeleted:"Session deleted.",alertCurrentOrderCleared:"Current data cleared.",printReportTitle:"Scanned Order Report",printSessionLabel:"Session:",printDateLabel:"Date:",printNoteLabel:"Note:",printExpectedItemsTitle:"Scanned Barcodes:",sessionNamePrefix:"Session",passcodeError:"Invalid passcode. Please try again."}},WEB_APP_URL="https://script.google.com/macros/s/AKfycbwCvptMvfnyyT1KXET2QfFBudL95ib7kK1A737v5wYPPh_X3v4p1zUZ8VDynaZ8rLix/exec";
    
    // --- UPDATED AND FIXED FUNCTIONS ---
    async function validateAndLoadApp(passcode) {
        el.passcodeError.textContent = '';
        el.passcodeSubmitBtn.disabled = true;
        el.passcodeSubmitBtn.textContent = 'Checking...';

        try {
            // THE FIX: Added a timestamp to prevent the browser from caching the request.
            const uniqueUrl = `${WEB_APP_URL}?passcode=${encodeURIComponent(passcode)}&t=${new Date().getTime()}`;
            const response = await fetch(uniqueUrl);

            if (!response.ok) {
                throw new Error("Network error. Please check your connection.");
            }

            const data = await response.json();

            // This is the critical security check.
            if (data.error) {
                throw new Error(data.error); // This will be "Access Denied" for wrong passcodes
            }

            // --- If passcode is correct, proceed ---
            userPasscode = passcode;
            allSessions = data;
            el.passcodeModal.style.display = 'none';
            el.mainApp.style.display = 'block';
            initializeMainApp();

        } catch (error) {
            // This block will now correctly execute for network errors AND wrong passcodes.
            console.error("Access Denied or Error:", error.message);
            el.passcodeError.textContent = translations[currentLanguage].passcodeError;
            el.passcodeSubmitBtn.disabled = false;
            el.passcodeSubmitBtn.textContent = 'Enter';
        }
    }
    
    async function autoSaveSession(barcode) {
        if (!currentSessionId) { currentSessionId = Date.now().toString(); }
        const sessionName = `${translations[currentLanguage].sessionNamePrefix} - ${getTimestamp(currentSessionId)}`;
        try {
            el.autoSaveStatus.classList.remove("show");
            const response = await fetch(WEB_APP_URL, {
                method: 'POST', mode: 'cors',
                body: JSON.stringify({
                    passcode: userPasscode, // Send passcode with save request
                    sessionID: currentSessionId, sessionName: sessionName, barcode: barcode
                })
            });
            const result = await response.json();
            if (result.status === 'success') {
                el.autoSaveStatus.classList.add("show");
                setTimeout(() => { el.autoSaveStatus.classList.remove("show") }, 2000);
            }
        } catch (error) { console.error('Network error during save:', error); }
    }

    // --- OTHER FUNCTIONS (No changes needed below this line) ---
    function initializeMainApp(){setLanguage(currentLanguage),updateClock(),setInterval(updateClock,1e3),filterSessionsByDate()}function loadSavedSessionsDropdown(e){el.savedSessionsSelect.innerHTML=`<option value="">${translations[currentLanguage].savedSessionsSelectPlaceholder}</option>`,e.sort((e,o)=>(o.createdAt||0)-(e.createdAt||0)).forEach(e=>{const o=document.createElement("option");o.value=e.id,o.textContent=e.name,el.savedSessionsSelect.appendChild(o)}),el.savedSessionsSelect.value=currentSessionId||""}function filterSessionsByDate(){const e=el.searchByDate.value;if(!e)return void loadSavedSessionsDropdown(allSessions);const o=allSessions.filter(o=>{const t=(new Date(o.createdAt||parseInt(o.id,10))).toLocaleDateString("en-CA");return t===e});loadSavedSessionsDropdown(o)}function loadSelectedSession(){const e=el.savedSessionsSelect.value;if(!e)return alert(translations[currentLanguage].alertSelectSession);const o=allSessions.find(o=>o.id===e);o&&(currentSessionId=o.id,scannedUniqueBarcodes=new Set(o.data.uniqueBarcodes||[]),alert(translations[currentLanguage].alertSessionLoaded(o.name)),renderPermanentBarcodes(),el.savedSessionsSelect.value=currentSessionId)}function deleteSelectedSession(){alert("Delete function is not supported. Please delete rows manually from the Google Sheet for now.")}function getTimestamp(e){const o=e?new Date(parseInt(e,10)):new Date;return o.toLocaleString("si"===currentLanguage?"si-LK":"en-US",{dateStyle:"short",timeStyle:"short",hour12:!1})}function updateClock(){el.liveClock.textContent=(new Date).toLocaleString("si"===currentLanguage?"si-LK":"en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0})}function showStatusMessage(e,o){el.statusMessage.textContent=e,el.statusMessage.className="status-message rounded-lg text-center font-semibold p-2",el.statusMessage.classList.add("success"===o?"bg-green-status":"bg-red-status","show"),setTimeout(()=>el.statusMessage.classList.remove("show"),2500)}function applyTranslations(){const e=translations[currentLanguage];document.documentElement.lang=currentLanguage,Object.keys(e).forEach(o=>{el[o]&&"object"==typeof el[o]&&void 0!==el[o].textContent&&(el[o].textContent=e[o])}),el.orderScanInput.placeholder=e.orderScanInputPlaceholder,el.customPrintTitle.placeholder=e.customPrintTitlePlaceholder,el.customPrintNote.placeholder=e.customPrintNotePlaceholder,el.savedSessionsSelect.querySelector("option").textContent=e.savedSessionsSelectPlaceholder,renderPermanentBarcodes(),filterSessionsByDate()}function setLanguage(e){currentLanguage=e,localStorage.setItem("appLanguage",e),applyTranslations(),el.langSinhalaBtn.classList.toggle("active","si"===e),el.langEnglishBtn.classList.toggle("active","en"===e)}function renderPermanentBarcodes(){el.scannedOrderBarcodesList.innerHTML="";const e=scannedUniqueBarcodes.size>0;el.noOrderBarcodesMessage.classList.toggle("hidden",!e),e&&(Array.from(scannedUniqueBarcodes).reverse().forEach((e,o)=>{const t=document.createElement("li");t.className="flex items-center justify-between p-2 rounded-md shadow-sm border text-lg font-medium bg-gray-700/50 border-gray-600/50 text-gray-200",t.innerHTML=`<span>${e}</span><span class="text-sm text-gray-400">#${scannedUniqueBarcodes.size-o}</span>`,el.scannedOrderBarcodesList.appendChild(t)}),el.orderListContainer.scrollTop=0),el.uniqueOrderCount.textContent=scannedUniqueBarcodes.size}function handleOrderScanAddBarcode(){const e=el.orderScanInput.value.trim();if(""===e)return;const o=translations[currentLanguage];scannedUniqueBarcodes.has(e)?showStatusMessage(o.duplicateScan(e),"error"):(scannedUniqueBarcodes.add(e),showStatusMessage(o.scannedSuccessfully(e),"success"),renderPermanentBarcodes(),autoSaveSession(e)),el.orderScanInput.value="",el.orderScanInput.focus()}function clearCurrentOrder(e=!0){scannedUniqueBarcodes.clear(),currentSessionId=null,renderPermanentBarcodes(),e&&alert(translations[currentLanguage].alertCurrentOrderCleared),el.savedSessionsSelect.value=""}function printScannedOrder(){if(0===scannedUniqueBarcodes.size)return void alert(translations[currentLanguage].noOrderBarcodesMessage);const e=translations[currentLanguage];document.getElementById("printReportTitle").textContent=el.customPrintTitle.value.trim()||e.printReportTitle,document.getElementById("printSessionName").textContent=el.savedSessionsSelect.options[el.savedSessionsSelect.selectedIndex]?.textContent||"Current Session",document.getElementById("printDate").textContent=getTimestamp(),document.getElementById("printSessionLabel").textContent=e.printSessionLabel,document.getElementById("printDateLabel").textContent=e.printDateLabel,document.getElementById("printExpectedItemsTitle").textContent=e.printExpectedItemsTitle,document.getElementById("printNoteLabel").textContent=e.printNoteLabel;const o=document.getElementById("printCustomNote"),t=el.customPrintNote.value.trim();o.querySelector("span").textContent=t,o.classList.toggle("empty",!t);const s=document.getElementById("printBarcodeList");s.innerHTML="",Array.from(scannedUniqueBarcodes).forEach((e,o)=>{const t=document.createElement("div");t.textContent=`${o+1}. ${e}`,s.appendChild(t)}),window.print()}function downloadCsv(){if(0===scannedUniqueBarcodes.size)return void alert(translations[currentLanguage].noOrderBarcodesMessage);const e="Barcode\n"+Array.from(scannedUniqueBarcodes).join("\n"),o=document.createElement("a");o.href=URL.createObjectURL(new Blob([e],{type:"text/csv;charset=utf-8;"})),o.download=`scanned_order_${Date.now()}.csv`,o.click()}const handlePasscodeSubmit=()=>{const e=el.passcodeInput.value.trim();e&&validateAndLoadApp(e)};el.passcodeSubmitBtn.addEventListener("click",handlePasscodeSubmit),el.passcodeInput.addEventListener("keypress",e=>{e.key==="Enter"&&handlePasscodeSubmit()}),el.langSinhalaBtn.addEventListener("click",()=>setLanguage("si")),el.langEnglishBtn.addEventListener("click",()=>setLanguage("en")),el.orderScanInput.addEventListener("keypress",e=>"Enter"===e.key&&handleOrderScanAddBarcode()),el.addOrderBarcodeBtn.addEventListener("click",handleOrderScanAddBarcode),el.clearCurrentOrderBtn.addEventListener("click",()=>clearCurrentOrder(!0)),el.printScannedOrderBtn.addEventListener("click",printScannedOrder),el.downloadCsvBtn.addEventListener("click",downloadCsv),el.loadSelectedSessionBtn.addEventListener("click",loadSelectedSession),el.deleteSelectedSessionBtn.addEventListener("click",deleteSelectedSession),el.searchByDate.addEventListener("input",filterSessionsByDate),el.resetDateFilterBtn.addEventListener("click",()=>{el.searchByDate.value="",filterSessionsByDate()});
    </script>
</body>
</html>